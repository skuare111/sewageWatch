# sewageWatch 项目配置文档

## 项目概述
sewageWatch 是一个污水监测系统，集成了多种技术栈，包括 Java、Python、Node.js 和 Vue.js，用于实时监控和分析污水情况。

## 系统要求

### 操作系统
- Windows 10 或 Windows 11

### 硬件要求
- 至少 4GB 内存
- 至少 2 核 CPU
- 至少 50GB 可用磁盘空间

## 软件依赖版本

### 1. Java
- 版本：Java 17
- 说明：项目使用 Spring Boot 3.4.6，需要 Java 17 运行环境

### 2. Python
- 版本：Python 3.9 或更高
- 主要依赖：FastAPI, OpenCV, YOLO, pymysql 等

### 3. Node.js
- 版本：Node.js 16 或更高
- 主要依赖：node-media-server 4.0.18

### 4. Vue.js
- 版本：Vue 3.5.13
- 构建工具：Vite 6.2.4

### 5. 数据库
- 版本：MySQL 8.0 或更高
- 数据库名：sewagewatch

### 6. FFmpeg
- 版本：最新稳定版
- 
- 用途：用于视频流处理

## 安装和配置步骤

### 步骤 1：安装 Java 17

1. 访问 [Oracle 官网](https://www.oracle.com/java/technologies/downloads/) 或 [OpenJDK 官网](https://jdk.java.net/17/)
2. 下载 Java 17 安装包
3. 运行安装程序并按照提示完成安装
4. 配置环境变量：
   - 右键点击"此电脑" -> "属性" -> "高级系统设置" -> "环境变量"
   - 在系统变量中新建 JAVA_HOME，值为 Java 安装路径（如 C:\Program Files\Java\jdk-17.0.1）
   - 编辑 Path 变量，添加 %JAVA_HOME%\bin
5. 验证安装：打开命令提示符，输入 `java -version`，应该显示 Java 17 版本信息

### 步骤 2：安装 Python 3.9+

1. 访问 [Python 官网](https://www.python.org/downloads/)
2. 下载 Python 3.9 或更高版本的安装包
3. 运行安装程序，勾选"Add Python to PATH"选项，然后点击"Install Now"
4. 验证安装：打开命令提示符，输入 `python --version`，应该显示 Python 版本信息
5. 安装项目依赖：
   ```bash
   cd d:\项目\sewageWatch\sewage-watch-Python
   pip install fastapi uvicorn opencv-python numpy pymysql python-multipart ultralytics
   ```

### 步骤 3：安装 Node.js 16+

1. 访问 [Node.js 官网](https://nodejs.org/en/download/)
2. 下载 Node.js 16 或更高版本的安装包
3. 运行安装程序并按照提示完成安装
4. 验证安装：打开命令提示符，输入 `node --version` 和 `npm --version`，应该显示相应版本信息
5. 安装 Node.js 项目依赖：
   ```bash
   cd d:\项目\sewageWatch\Node.js
   npm install
   ```
6. 安装 Vue 项目依赖：
   ```bash
   cd d:\项目\sewageWatch\Vue
   npm install
   ```

### 步骤 4：安装 MySQL 8.0+

1. 访问 [MySQL 官网](https://dev.mysql.com/downloads/installer/)
2. 下载 MySQL 8.0 或更高版本的安装包
3. 运行安装程序并按照提示完成安装
4. 配置 MySQL 服务，设置 root 密码
5. 创建数据库：
   - 打开 MySQL 命令行客户端或 MySQL Workbench
   - 登录 MySQL：`mysql -u root -p`，然后输入密码
   - 执行 `createDatabase.sql` 脚本创建数据库和表：
     ```bash
     source d:\项目\sewageWatch\createDatabase.sql
     ```

### 步骤 5：安装 FFmpeg

1. 访问 [FFmpeg 官网](https://ffmpeg.org/download.html)
2. 下载 Windows 版本的 FFmpeg
3. 解压文件到本地目录（如 C:\ffmpeg）
4. 配置环境变量：将 FFmpeg 的 bin 目录添加到系统 Path 变量中
5. 验证安装：打开命令提示符，输入 `ffmpeg -version`，应该显示 FFmpeg 版本信息

### 步骤 6：修改配置文件

1. 修改 `start.bat` 文件中的项目路径：
   ```bat
   set "BASE=D:\项目\sewageWatch"  REM 修改为你的实际项目路径
   ```

2. 检查 `config.xml` 文件中的配置：
   - 确认 RTMP URL 设置正确
   - 确认数据库连接信息正确（主机、端口、用户名、密码）

### 步骤 7：启动项目

1. 运行 `start.bat` 文件启动所有服务：
   ```bash
   cd d:\项目\sewageWatch
   start.bat
   ```
2. 所有服务的日志会保存在 `logs` 目录下

### 步骤 8：停止项目

1. 运行 `stop.bat` 文件停止所有服务：
   ```bash
   cd d:\项目\sewageWatch
   stop.bat
   ```
2. 该脚本会关闭占用指定端口（1935, 5173, 8000, 8080, 8081）的所有进程

## 项目结构说明

```
sewageWatch/
├── Node.js/              # Node.js 视频流服务器
├── Vue/                  # Vue 前端项目
├── sewage-watch-JAVA/    # Java 后端项目
├── sewage-watch-Python/  # Python 视频分析项目
├── logs/                 # 日志文件目录
├── createDatabase.sql    # 数据库创建脚本
├── config.xml            # 全局配置文件
├── start.bat             # 启动脚本
└── stop.bat              # 停止脚本
```

## 服务端口说明

- RTMP 服务：1935 端口（Node.js 视频流服务器）
- Vue 开发服务器：5173 端口（前端界面）
- Python API：8000 端口（视频分析 API）
- Java API：8080 或 8081 端口（后端服务）

## 访问系统

1. 打开浏览器，访问 `http://localhost:5173` 进入前端界面
2. 使用以下账号登录：
   - 管理员账号：ADMIN / 123456
   - 巡检员账号：3029489598 / 123456
   - 普通用户账号：123456 / 123456

## 常见问题解决

1. **端口占用问题**：
   - 如果启动时提示端口已被占用，运行 `stop.bat` 关闭相关进程，然后再次启动
   - 或手动修改配置文件中的端口设置

2. **数据库连接失败**：
   - 检查 `config.xml` 文件中的数据库连接信息是否正确
   - 确认 MySQL 服务是否正在运行

3. **视频流无法播放**：
   - 检查 FFmpeg 是否正确安装
   - 确认 `sample.mp4` 文件是否存在于 Node.js 目录下
   - 检查防火墙设置是否允许 RTMP 流量通过

4. **依赖安装失败**：
   - 确认网络连接正常
   - 尝试使用管理员权限运行命令行
   - 对于 Python 依赖，可以尝试使用国内镜像源：`pip install -i https://pypi.tuna.tsinghua.edu.cn/simple 包名`